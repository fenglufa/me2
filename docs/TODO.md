# AI 分身项目开发 TODO List

## 项目初始化
- [x] 创建项目目录结构 (backend, app, web)
- [x] 完成架构设计文档 (服务架构说明.md)
- [ ] 初始化后端项目 (Go + go-zero)
- [ ] 配置开发环境 (Postgres + Redis + 向量数据库)

## 后端开发 - 基础设施

### 数据库设计与迁移
- [ ] 设计核心数据表结构
  - [ ] users 表 (手机号登录)
  - [ ] sms_codes 表 (短信验证码)
  - [ ] avatars 表 (分身核心数据 + 6维人格)
  - [ ] avatar_milestones 表 (成长节点)
  - [ ] avatar_stats 表 (统计数据)
  - [ ] event_templates 表 (事件模板)
  - [ ] events_history 表 (事件历史)
  - [ ] world_regions 表 (世界区域)
  - [ ] world_scenes 表 (世界场景)
  - [ ] avatar_locations 表 (分身位置)
  - [ ] dialogues 表 (对话历史)
  - [ ] diaries 表 (分身日记 + 用户日记)
  - [ ] ai_prompts 表 (Prompt 模板)
  - [ ] ai_call_logs 表 (AI 调用日志)
- [ ] 编写数据库迁移脚本
- [ ] 配置 Redis 缓存
- [ ] 配置向量数据库 (Milvus/Pinecone)

### 微服务搭建 (go-zero) - 按优先级排序

#### 第一优先级 - 基础设施服务
- [ ] 1. SMS Service (短信服务)
  - [ ] 集成阿里云短信 SDK
  - [ ] 验证码发送和校验
  - [ ] 防刷机制

- [ ] 2. OSS Service (对象存储服务)
  - [ ] 集成阿里云 OSS SDK
  - [ ] STS 临时授权
  - [ ] 客户端直传支持
  - [ ] 文件删除管理

#### 第二优先级 - 核心数据层
- [ ] 3. User Service (用户服务)
  - [ ] 手机号 + 验证码登录
  - [ ] JWT 认证
  - [ ] 订阅状态管理
  - [ ] 用户设置

- [ ] 4. Avatar Service (分身服务) ⭐
  - [ ] 分身创建 API
  - [ ] 6维人格系统
  - [ ] 分身状态管理
  - [ ] 成长系统 (等级/经验)
  - [ ] 关系系统 (信任/亲密/共鸣)
  - [ ] 成长节点记录
  - [ ] 统计数据聚合

#### 第三优先级 - AI 核心服务
- [ ] 5. AI Service (AI 统一服务) ⭐⭐⭐
  - [ ] 封装 Deepseek API 客户端
  - [ ] Prompt 模板管理系统
  - [ ] 支持流式和非流式调用
  - [ ] 智能缓存 (Redis)
  - [ ] Token 使用量统计
  - [ ] 成本监控
  - [ ] 错误处理和重试
  - [ ] 健康检查接口
  - [ ] 支持以下场景:
    - [ ] avatar_chat (分身对话)
    - [ ] event_story (事件故事生成)
    - [ ] avatar_diary (分身日记生成)
    - [ ] user_diary_reply (用户日记回应)
    - [ ] emotion_analysis (情绪分析)

#### 第四优先级 - 世界系统
- [ ] 6. World Service (世界服务)
  - [ ] 区域管理 (4个基础区域)
  - [ ] 场景管理
  - [ ] 分身位置追踪
  - [ ] 区域内分身查询

#### 第五优先级 - 行为与事件系统
- [ ] 7. Action Service (行动逻辑服务) ⭐
  - [ ] 行动调度器 (定时任务)
  - [ ] 时间段行为倾向计算
  - [ ] 行动意图计算器
  - [ ] 行为选择器
  - [ ] 冷却时间管理

- [ ] 8. Event Service (事件生成服务) ⭐
  - [ ] 事件模板管理
  - [ ] 事件实例生成 (调用 AI Service)
  - [ ] 事件历史管理
  - [ ] 时间线查询
  - [ ] 性格影响计算

#### 第六优先级 - 日记系统
- [ ] 9. Diary Service (日记服务)
  - [ ] 分身日记自动生成 (调用 AI Service)
  - [ ] 用户日记提交
  - [ ] 分身回应生成 (调用 AI Service)
  - [ ] 情绪分析 (调用 AI Service)
  - [ ] 日记查询和统计
  - [ ] 重要日记向量化 (Memory Service)

#### 第七优先级 - 对话系统
- [ ] 10. Dialogue Service (对话服务)
  - [ ] 对话上下文管理
  - [ ] 调用 AI Service (流式)
  - [ ] 注入分身性格
  - [ ] 注入最近事件
  - [ ] 长期记忆检索 (Memory Service)
  - [ ] WebSocket 支持
  - [ ] 对话历史存储

#### 第八优先级 - 记忆系统
- [ ] 11. Memory Service (记忆服务)
  - [ ] 向量数据库集成
  - [ ] 文本向量化 (调用 AI Service Embedding)
  - [ ] RAG 检索
  - [ ] 记忆存储和删除

#### 第九优先级 - 内容生成
- [ ] 12. ImageGen Service (图像生成服务)
  - [ ] 事件插画生成
  - [ ] 分身表情图生成
  - [ ] 分享海报生成
  - [ ] 上传到 OSS Service
  - [ ] 异步任务队列

- [ ] 13. Notify Service (通知服务)
  - [ ] 推送通知 (APNs/FCM)
  - [ ] WebSocket 实时通知
  - [ ] MQTT (未来硬件)

#### 第十优先级 - API Gateway
- [ ] 14. API Gateway (网关服务)
  - [ ] JWT 认证和鉴权
  - [ ] 限流、熔断
  - [ ] 路由转发
  - [ ] A/B 测试分流

## MVP 核心功能实现

### 首页功能
- [ ] 分身当前动态展示
- [ ] 分身状态动画
- [ ] 氛围背景
- [ ] 对话入口

### 分身模块
- [ ] 性格面板 (6维曲线图)
- [ ] 分身日记展示
- [ ] 成长节点展示
- [ ] 关系面板 (信任/亲密/共鸣)

### 世界模块
- [ ] 4个基础区域展示
- [ ] 分身位置显示
- [ ] 事件触发和展示
- [ ] 区域卡片系统

### "我"模块
- [ ] 用户基本信息
- [ ] 分身初始设定
- [ ] 订阅入口
- [ ] 日记查看
- [ ] 聊天记录
- [ ] 情绪记录面板
- [ ] 隐私管理

## 阿里云服务配置
- [ ] 短信服务配置
  - [ ] 配置短信模板
  - [ ] 设置发送限制
- [ ] OSS 对象存储配置
  - [ ] 创建 Bucket
  - [ ] 配置 STS 临时凭证
  - [ ] 设置目录结构 (/avatars/, /events/, /posters/)

## App 开发
- [ ] 待规划 (架构设计完成后开始)

## Web 开发
- [ ] 待规划 (架构设计完成后开始)

## 测试与部署
- [ ] 单元测试
- [ ] 集成测试
- [ ] Docker 配置
- [ ] CI/CD 配置
- [ ] 监控和日志系统

---

**当前状态**: 架构设计完成 ✅
**当前优先级**: 后端基础架构搭建
**开始时间**: 2025-12-01
**架构设计完成时间**: 2025-12-02

**重要说明**:
1. 所有 AI 调用必须通过 AI Service,不得直接调用外部 AI API
2. User 表只存储账号信息,昵称和头像存储在 Avatar 表
3. MVP 阶段一个用户只能有一个分身
4. 开发顺序严格按照优先级,AI Service 是核心依赖,必须优先完成
